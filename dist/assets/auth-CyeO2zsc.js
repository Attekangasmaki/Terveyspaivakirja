import"./style-SDVZoXYC.js";import{f as i}from"./fetch-Bt5pIeqq.js";console.log("Moi luodaan nyt tokeneita ja kirjaudutaan sisään");const u=async s=>{s.preventDefault();const o=document.querySelector(".registerForm"),r=o.querySelector("#username").value.trim(),l=o.querySelector("#password").value.trim(),n=o.querySelector("#email").value.trim(),t={username:r,password:l,email:n},c="http://localhost:5000/api/users",e={body:JSON.stringify(t),method:"POST",headers:{"Content-type":"application/json"}};console.log(e);const a=await i(c,e);if(a.error){console.error("Error adding a new user:",a.error);return}a.message&&console.log(a.message,"success"),console.log(a),o.reset()},m=async s=>{s.preventDefault();const o=document.querySelector(".loginForm"),r=o.querySelector("input[name=username]").value,l=o.querySelector("input[name=password]").value,n={username:r,password:l},t="http://localhost:5000/api/auth/login",c={body:JSON.stringify(n),method:"POST",headers:{"Content-type":"application/json"}};console.log(c);const e=await i(t,c);if(e.error){console.error("Error loginning in:",e.error);return}e.token&&e.user?(console.log("Kirjautuminen onnistui! Token:",e.token),localStorage.setItem("token",e.token),localStorage.setItem("user_id",e.user.id),localStorage.setItem("nimi",e.user.username),location.href="./userfrontpage.html"):console.error("Virhe: Tokenia tai käyttäjä-ID:tä ei palautettu."),e.message&&console.log(e.message,"success"),console.log(e),o.reset()},g=async s=>{s.preventDefault();const o="http://localhost:5000/api/auth/me";let r={};r={Authorization:`Bearer ${localStorage.getItem("token")}`};const n={headers:r};console.log(n);const t=await i(o,n);if(t.error){console.error("Error cheking new user:",t.error);return}t.message&&(console.log(t.message,"success"),localStorage.setItem("token",t.token)),console.log(t),loginForm.reset()};document.addEventListener("DOMContentLoaded",()=>{const s=document.querySelector(".registerForm");s&&s.addEventListener("submit",u);const o=document.querySelector(".loginForm");o&&o.addEventListener("submit",m);const r=document.querySelector("#meRequest");r&&r.addEventListener("click",g)});
